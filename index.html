
<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SayaJove Nadi Astrology</title>
    <style>
        :root { --primary: #1a237e; --accent: #ffd600; --bg: #f5f5f5; --line: #333; }
        body { font-family: sans-serif; background: var(--bg); padding: 10px; }
        .container { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .chart-grid { display: grid; grid-template-columns: repeat(4, 1fr); border: 2px solid var(--line); margin: 20px 0; }
        .house { border: 1px solid var(--line); height: 80px; padding: 5px; font-size: 11px; position: relative; background: #fff; }
        .house-id { position: absolute; bottom: 2px; right: 4px; color: #eee; font-weight: bold; }
        .p-tag { color: #0d47a1; font-weight: bold; display: block; margin-bottom: 2px; }
        .center-box { grid-column: 2 / 4; grid-row: 2 / 4; display: flex; align-items: center; justify-content: center; background: #f8f9fa; border: 1px solid var(--line); text-align: center; font-weight: bold; color: var(--primary); font-size: 14px; }
        .cat-title { background: #1a237e; color: white; padding: 8px; border-radius: 5px; margin-top: 15px; font-weight: bold; }
        .res-card { border-left: 5px solid var(--accent); background: #fffde7; padding: 12px; margin: 8px 0; border-radius: 4px; font-size: 14px; line-height: 1.6; }
        button { width: 100%; background: #1b5e20; color: white; border: none; padding: 15px; border-radius: 8px; cursor: pointer; font-size: 16px; margin-top: 10px; font-weight: bold; }
        button:hover { background: #0d3d10; }
        input { padding: 10px; border: 1px solid #ccc; border-radius: 5px; width: 44%; margin-bottom: 5px; }
    </style>
</head>
<body>

<div class="container">
    <h2 style="text-align:center; color:var(--primary);">SayaJove á€”á€’á€®á€”á€€á€¹á€á€á€ºá€—á€±á€’á€„á€º</h2>
    
    <div style="text-align:center; margin-bottom: 20px;">
        <input type="date" id="dob" value="1985-11-08">
        <input type="time" id="tob" value="15:03">
        <button onclick="calculateNadi()">á€‡á€¬á€á€¬á€á€½á€€á€ºá€á€»á€€á€ºá€™á€Šá€º</button>
    </div>

    <div class="chart-grid" id="main-chart">
        <div class="house" id="h11"><div class="house-id">12</div></div>
        <div class="house" id="h0"><div class="house-id">1</div></div>
        <div class="house" id="h1"><div class="house-id">2</div></div>
        <div class="house" id="h2"><div class="house-id">3</div></div>
        <div class="house" id="h10"><div class="house-id">11</div></div>
        <div class="center-box">á€”á€’á€®á€”á€€á€¹á€á€á€ºá€—á€±á€’á€„á€º<br>Master System</div>
        <div class="house" id="h3"><div class="house-id">4</div></div>
        <div class="house" id="h9"><div class="house-id">10</div></div>
        <div class="house" id="h4"><div class="house-id">5</div></div>
        <div class="house" id="h8"><div class="house-id">9</div></div>
        <div class="house" id="h7"><div class="house-id">8</div></div>
        <div class="house" id="h6"><div class="house-id">7</div></div>
        <div class="house" id="h5"><div class="house-id">6</div></div>
    </div>
    
    <div id="result-area"></div>
</div>

<script>
// á€¡á€­á€™á€ºá€›á€¾á€„á€ºá€™á€»á€¬á€¸ á€á€á€ºá€™á€¾á€á€ºá€á€»á€€á€º
const owners = { Sun:[4], Moon:[3], Mars:[0,7], Mercury:[2,5], Jupiter:[8,11], Venus:[1,6], Saturn:[9,10] };

async function calculateNadi() {
    const dob = document.getElementById('dob').value;
    const tob = document.getElementById('tob').value;
    const resArea = document.getElementById('result-area');
    resArea.innerHTML = "<p style='text-align:center;'>á€á€½á€€á€ºá€á€»á€€á€ºá€”á€±á€•á€«á€á€Šá€º...</p>";

    try {
        const response = await fetch(`/api/calc?dob=${dob}&tob=${tob}`);
        const data = await response.json();
        
        if (data.error) throw new Error(data.error);

        // á€‡á€¬á€á€¬á€á€½á€„á€º á€á€”á€·á€ºá€›á€¾á€„á€ºá€¸á€›á€±á€¸á€œá€¯á€•á€º
        for(let i=0; i<12; i++) {
            document.getElementById(`h${i}`).innerHTML = `<div class="house-id">${i+1}</div>`;
        }

        const pAbbr = {Sun:'Su', Moon:'Mo', Mars:'Ma', Mercury:'Me', Jupiter:'Ju', Venus:'Ve', Saturn:'Sa', Rahu:'Ra', Ketu:'Ke', Ascendant:'As'};
        
        // á€‚á€¼á€­á€¯á€Ÿá€ºá€™á€»á€¬á€¸á€€á€­á€¯ á€‡á€¬á€á€¬á€á€½á€„á€ºá€‘á€² á€‘á€Šá€·á€ºá€á€¼á€„á€ºá€¸
        Object.entries(data.positions).forEach(([p, deg]) => {
            const sign = Math.floor(deg / 30);
            if(document.getElementById(`h${sign}`)) {
                document.getElementById(`h${sign}`).innerHTML += `<span class="p-tag">${pAbbr[p] || p} ${Math.floor(deg%30)}Â°</span>`;
            }
        });

        // á€Ÿá€±á€¬á€á€»á€€á€º Logic á€™á€»á€¬á€¸á€¡á€¬á€¸ á€á€±á€«á€ºá€šá€°á€á€¼á€„á€ºá€¸
        runNadiLogic(data.positions);

    } catch(e) {
        resArea.innerHTML = "<div class='res-card' style='color:red;'>Error: " + e.message + "</div>";
    }
}

function runNadiLogic(pos) {
    let resultHTML = "";
    let chart = {};

    // á€‚á€¼á€­á€¯á€Ÿá€ºá€á€Šá€ºá€”á€±á€›á€¬á€™á€»á€¬á€¸á€€á€­á€¯ Object á€‘á€²á€á€­á€¯á€· á€•á€¼á€±á€¬á€„á€ºá€¸á€á€¼á€„á€ºá€¸
    Object.entries(pos).forEach(([p, deg]) => {
        chart[p] = { house: Math.floor(deg / 30), degree: deg % 30 };
    });

// áá‹ Dignities á€á€á€ºá€™á€¾á€á€ºá€á€»á€€á€º
    const dignities = {
        Sun: { exalt: 0, debilit: 6 },
        Moon: { exalt: 1, debilit: 7 },
        Mars: { exalt: 9, debilit: 3 },
        Mercury: { exalt: 5, debilit: 11 },
        Jupiter: { exalt: 3, debilit: 9 },
        Venus: { exalt: 11, debilit: 5 },
        Saturn: { exalt: 6, debilit: 0 },
        Rahu: { exalt: 1, debilit: 7 },
        Ketu: { exalt: 7, debilit: 1 }
    };

    // á‚á‹ Dignity á€…á€…á€ºá€†á€±á€¸á€á€Šá€·á€º Function
    const getDignity = (p) => {
        if (!chart[p] || !dignities[p]) return "";
        if (chart[p].house === dignities[p].exalt) return "EXALT";
        if (chart[p].house === dignities[p].debilit) return "DEBILIT";
        return "";
    };

    // áƒá‹ á€‚á€¼á€­á€¯á€Ÿá€ºá€á€…á€ºá€á€¯á€á€»á€„á€ºá€¸á€…á€®á€€á€­á€¯ Dignity á€…á€…á€ºá€•á€¼á€®á€¸ Alert á€‘á€²á€‘á€Šá€·á€ºá€á€¼á€„á€ºá€¸
    const planetNamesMM = { Sun:'á€á€”á€„á€ºá€¹á€‚á€”á€½á€±', Moon:'á€á€”á€„á€ºá€¹á€œá€¬', Mars:'á€¡á€„á€ºá€¹á€‚á€«', Mercury:'á€—á€¯á€’á€¹á€“á€Ÿá€°á€¸', Jupiter:'á€€á€¼á€¬á€á€•á€á€±á€¸', Venus:'á€á€±á€¬á€€á€¼á€¬', Saturn:'á€…á€”á€±', Rahu:'á€›á€¬á€Ÿá€¯', Ketu:'á€€á€­á€á€º' };

    Object.keys(dignities).forEach(p => {
        let status = getDignity(p);
        if (status === "EXALT") {
            alerts.push(`ğŸŒŸ <b>${planetNamesMM[p]}</b> á€á€Šá€º á€¡á€‘á€°á€¸á€¡á€¬á€¸á€€á€±á€¬á€„á€ºá€¸á€á€±á€¬ (á€¥á€¯á€…á€º) á€¡á€á€¼á€±á€¡á€”á€±á€á€½á€„á€º á€›á€¾á€­á€”á€±á€•á€«á€á€Šá€ºá‹`);
        } else if (status === "DEBILIT") {
            alerts.push(`âš ï¸ <b>${planetNamesMM[p]}</b> á€á€Šá€º á€¡á€¬á€¸á€”á€Šá€ºá€¸á€á€±á€¬ (á€”á€­á€…á€º) á€¡á€á€¼á€±á€¡á€”á€±á€á€½á€„á€º á€›á€¾á€­á€”á€±á€•á€«á€á€Šá€ºá‹`);
        }
    });
    
    // á€”á€’á€®á€¡á€™á€¼á€„á€º (ááŠ á…áŠ á‰áŠ áƒáŠ á‡áŠ áá) á€…á€…á€ºá€†á€±á€¸á€á€¼á€„á€ºá€¸
    const isAspect = (p1, p2) => {
        if (!chart[p1] || !chart[p2]) return false;
        let diff = (chart[p2].house - chart[p1].house + 12) % 12;
        // á€”á€’á€®á€…á€”á€…á€ºá€¡á€› á€¡á€™á€¼á€„á€ºá€™á€»á€¬á€¸
        return [0, 4, 8, 2, 6, 10].includes(diff);
    };


    

    
    // á€¡á€­á€™á€ºá€–á€œá€¾á€šá€ºá€á€¼á€„á€ºá€¸ (Parivartana) á€…á€…á€ºá€†á€±á€¸á€á€¼á€„á€ºá€¸
    const isInterchange = (p1, p2) => {
        if (!chart[p1] || !chart[p2]) return false;
        return owners[p1]?.includes(chart[p2].house) && owners[p2]?.includes(chart[p1].house);
    };

    // --- á€Ÿá€±á€¬á€á€»á€€á€ºá€™á€»á€¬á€¸ á€…á€¯á€…á€Šá€ºá€¸á€™á€¾á€¯ (á€†á€›á€¬á€€á€¼á€®á€¸ á€¤á€”á€±á€›á€¬á€á€½á€„á€º á€…á€¬á€á€¬á€¸á€™á€»á€¬á€¸ á€‘á€•á€ºá€á€­á€¯á€¸á€”á€­á€¯á€„á€ºá€•á€«á€á€Šá€º) ---
    const effects = [
        { cat: "family", check: () => isAspect('Moon', 'Rahu'), text: "<b>á€á€”á€„á€ºá€¹á€œá€¬+á€›á€¬á€Ÿá€¯:</b> á€™á€­á€á€„á€ºá€–á€¼á€…á€ºá€á€°á€™á€¾á€¬ á€‡á€¬á€á€¬á€›á€¾á€„á€ºá€™á€½á€±á€¸á€…á€á€½á€„á€º á€€á€»á€”á€ºá€¸á€™á€¬á€›á€±á€¸ á€¡á€¬á€¸á€”á€Šá€ºá€¸á€á€á€ºá€á€¼á€„á€ºá€¸ á€á€­á€¯á€·á€™á€Ÿá€¯á€á€º á€…á€­á€á€ºá€á€±á€¬á€€ á€›á€±á€¬á€€á€ºá€á€á€ºá€á€Šá€ºá‹" },
        { cat: "career", check: () => isAspect('Saturn', 'Ketu'), text: "<b>á€…á€”á€±+á€€á€­á€á€º:</b> á€¡á€œá€¯á€•á€ºá€¡á€€á€­á€¯á€„á€ºá€á€½á€„á€º á€›á€¯á€á€ºá€á€›á€€á€º á€¡á€•á€¼á€±á€¬á€„á€ºá€¸á€¡á€œá€²á€™á€»á€¬á€¸ á€á€­á€¯á€·á€™á€Ÿá€¯á€á€º á€á€­á€Šá€¬á€‰á€ºá€›á€±á€¸á€›á€¬á€”á€¾á€„á€·á€º á€•á€á€ºá€á€€á€ºá€á€±á€¬ á€¡á€œá€¯á€•á€ºá€™á€»á€¬á€¸ á€¡á€€á€»á€­á€¯á€¸á€•á€±á€¸á€™á€Šá€ºá‹" },
        { cat: "fortune", check: () => isAspect('Jupiter', 'Venus') && isAspect('Jupiter', 'Mercury'), text: "<b>á€“á€”á€á€­á€’á€¹á€“á€­á€šá€±á€¬á€‚:</b> á€„á€½á€±á€€á€¼á€±á€¸á€€á€¶ á€¡á€œá€½á€”á€ºá€€á€±á€¬á€„á€ºá€¸á€™á€½á€”á€ºá€•á€¼á€®á€¸ á€•á€Šá€¬á€›á€¾á€­á€™á€»á€¬á€¸á á€¡á€€á€°á€¡á€Šá€® á€›á€›á€¾á€­á€™á€Šá€ºá‹" },
        { cat: "marriage", check: () => isAspect('Venus', 'Ketu'), text: "<b>á€á€±á€¬á€€á€¼á€¬+á€€á€­á€á€º:</b> á€¡á€­á€™á€ºá€‘á€±á€¬á€„á€ºá€–á€€á€ºá€™á€¾á€¬ á€˜á€¬á€á€¬á€á€›á€¬á€¸ á€€á€­á€¯á€„á€ºá€¸á€›á€¾á€­á€¯á€„á€ºá€¸á€á€° á€–á€¼á€…á€ºá€á€á€ºá€á€Šá€ºá‹" },
        { cat: "career", check: () => isInterchange('Mars', 'Mercury'), text: "<b>á€¡á€„á€ºá€¹á€‚á€«+á€—á€¯á€’á€¹á€“á€Ÿá€°á€¸ (á€¡á€­á€™á€ºá€–á€œá€¾á€šá€ºá€á€¼á€„á€ºá€¸):</b> á€…á€€á€¬á€¸á€•á€¼á€±á€¬á€†á€­á€¯á€›á€¬á€á€½á€„á€º á€¡á€œá€½á€”á€ºá€‘á€€á€ºá€™á€¼á€€á€ºá€•á€¼á€®á€¸ á€”á€Šá€ºá€¸á€•á€Šá€¬ á€á€­á€¯á€·á€™á€Ÿá€¯á€á€º á€…á€¬á€›á€„á€ºá€¸á€¡á€„á€ºá€¸á€•á€Šá€¬á€–á€¼á€„á€·á€º á€¡á€±á€¬á€„á€ºá€™á€¼á€„á€ºá€™á€Šá€ºá‹" },
        { cat: "fortune", check: () => isAspect('Sun', 'Jupiter'), text: "<b>á€á€”á€„á€ºá€¹á€‚á€”á€½á€±+á€€á€¼á€¬á€á€•á€á€±á€¸:</b> á€¡á€…á€­á€¯á€¸á€› á€á€­á€¯á€·á€™á€Ÿá€¯á€á€º á€¡á€€á€¼á€®á€¸á€¡á€€á€²á€™á€»á€¬á€¸á á€¡á€‘á€±á€¬á€€á€ºá€¡á€•á€¶á€· á€›á€›á€¾á€­á€™á€Šá€ºá‹ á€‚á€¯á€á€ºá€á€­á€€á€¹á€á€¬á€€á€¼á€®á€¸á€™á€¬á€¸á€á€°á€–á€¼á€…á€ºá€™á€Šá€ºá‹" }
    ];

    // á€Ÿá€±á€¬á€á€»á€€á€ºá€™á€»á€¬á€¸á€€á€­á€¯ á€¡á€™á€»á€­á€¯á€¸á€¡á€…á€¬á€¸á€¡á€œá€­á€¯á€€á€º á€á€½á€²á€‘á€¯á€á€ºá€•á€¼á€á€á€¼á€„á€ºá€¸
    let catNames = { fortune: "á€€á€¶á€€á€¼á€™á€¹á€™á€¬", career: "á€¡á€œá€¯á€•á€ºá€¡á€€á€­á€¯á€„á€º", marriage: "á€¡á€­á€™á€ºá€‘á€±á€¬á€„á€ºá€›á€±á€¸", family: "á€™á€­á€á€¬á€¸á€…á€¯", spiritual: "á€á€­á€Šá€¬á€‰á€ºá€›á€±á€¸á€›á€¬" };

    Object.keys(catNames).forEach(c => {
        let filtered = effects.filter(e => e.cat === c && e.check());
        if(filtered.length > 0) {
            resultHTML += `<div class="cat-title">${catNames[c]}</div>`;
            filtered.forEach(f => { 
                resultHTML += `<div class="res-card">${f.text}</div>`; 
            });
        }
    });

    document.getElementById('result-area').innerHTML = resultHTML || "<p style='text-align:center; padding:20px;'>á€šá€á€¯á€‡á€¬á€á€¬á€¡á€á€½á€€á€º á€‘á€°á€¸á€á€¼á€¬á€¸á€á€±á€¬ á€”á€’á€®á€šá€±á€¬á€‚á€™á€»á€¬á€¸ á€™á€á€½á€±á€·á€›á€¾á€­á€á€±á€¸á€•á€«á‹</p>";
}
</script>

</body>
</html>
